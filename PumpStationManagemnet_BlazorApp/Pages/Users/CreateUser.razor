@page "/users/create"
@using PumpStationManagemnet_BlazorApp.DTOs
@using PumpStationManagemnet_BlazorApp.Models
@using PumpStationManagemnet_BlazorApp.Services
@using PumpStationManagemnet_BlazorApp.Enums
@inject PumpStationManagemnet_BlazorApp.Services.UserService UserService
@inject IJSRuntime JS
@inject NavigationManager NavigationManager
<h3  class="text-center mb-3" >CreateUser</h3>

<EditForm Model="@userDto" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label class="form-label">Tên đăng nhập</label>
        <InputText class="form-control" @bind-Value="userDto.Username" />
    </div>
    <div class="mb-3">
        <label class="form-label">Họ tên</label>
        <InputText class="form-control" @bind-Value="userDto.FullName" />
    </div>
    <div class="mb-3">
        <label class="form-label">Email</label>
        <InputText class="form-control" @bind-Value="userDto.Email" />
    </div>
    <div class="mb-3">
        <label class="form-label">Số điện thoại</label>
        <InputText class="form-control" @bind-Value="userDto.PhoneNumber" />
    </div>
    <div class="mb-3">
        <label class="form-label">Vai trò</label>
        <InputSelect class="form-control" @bind-Value="userDto.Role">
            @foreach (var option in userRole)
            {
                <option value="@Convert.ToInt32(option.Key)">@option.Value</option>
            }
        </InputSelect>
    </div>
    <div class="mb-3 form-check">
        <InputCheckbox class="form-check-input" @bind-Value="isActiveTemp" />
        <label class="form-check-label">Hoạt động</label>
    </div>
    <button type="submit" class="btn btn-primary">Tạo</button>
    <a class="btn btn-secondary ms-2" href="/users">Hủy</a>
</EditForm>

@code {
    private UserDTO userDto = new();
    private bool isActiveTemp = true;
    private List<KeyValuePair<Enum, string>> userRole = EnumHelper.GetEnumListWithDescriptions<UserRole>();
    private async Task HandleValidSubmit()
    {
        userDto.CreatedBy = 1;
        var response = await UserService.CreateUserAsync(userDto);
        if (response.IsSuccessStatusCode)
        {
            NavigationManager.NavigateTo("/users");
        }
        else
        {
            // Xử lý lỗi (hiển thị thông báo)
        }
    }
}
